# Event Loops

Events are processed by iterating through all available events and merging the results
into a single `EventResult`.
Here, events generated by the `embedded-graphics-simulator` window are mapped into Buoyant
events.

```rust,ignore
{{#include event-loops.rs:handle_events}}
```

The merged `EventResult` contains several flags to inform the event loop of when updates
are necessary:

- `recompute_view` indicates that the view hierarchy needs to be rebuilt (and redrawn).
- `redraw` indicates that the current view should be redrawn, but a view rebuild is not
  necessary.

## External state changes

Generally, state changed as a direct result of user input (e.g. button taps) will
cause the `recompute_view` flag to be set. However, if state is changed externally
such as in response to a network event, Buoyant will not be aware of it.

To handle external state changes, the event loop could be extended in several ways,
including:

- A check for equality between the previous and current state either directly or with a
  hash, or
- If equality checks are expensive, `Event::External` events can be published to an event
  channel and the `recompute_view` flag can be set when such an event is received by the
  event loop.

## Pausing When Idle

Some render tree nodes, such as animations, report their animation status to the render
target. This flag can be checked and cleared with `.clear_animation_status()` to determine
whether rendering a new frame is necessary.

```rust,ignore
{{#include event-loops.rs:render_idle}}
```

## Complete Example

```rust,no_run
# extern crate buoyant;
# extern crate embedded_graphics;
# extern crate embedded_graphics_simulator;
{{#include event-loops.rs:all}}
```
